# Whatâ€™s New In Python 3.14

- <https://docs.python.org/3.14/whatsnew/3.14.html>

## Important

1. Deferred Evaluation Of Annotations Using Descriptors, ç›´æ¥æ”¯æŒå»¶è¿Ÿæ³¨è§£, ä¸å†éœ€è¦`from __future__ import annotations`

### PEP 734: Multiple interpreters in the standard library

åœ¨ä¸€ä¸ªè¿›ç¨‹ä¸­å…è®¸ä¸é€šè¿‡`C-API`è¿è¡Œå¤šä¸ªè§£é‡Šå™¨ä»¥æ”¯æŒçœŸæ­£çš„å¹¶è¡Œèƒ½åŠ›

- concurrent.interpreters
- concurrent.futures.InterpreterPoolExecutor

#### Current limitations

1. è§£é‡Šå™¨å¯åŠ¨æœªä¼˜åŒ–
2. è§£é‡Šå™¨ä¹‹é—´çš„å†…å­˜å…±äº«
3. ç¬¬ä¸‰æ–¹å·²ç»æ”¯æŒçš„ä¸å¤š
4. ç¼–ç æ–¹å¼å¯¹äºå¤§å¤šæ•°ç”¨æˆ·æ¯”è¾ƒé™Œç”Ÿ

### PEP 750: Template string literals

ç”¨æ³•ä¸f-string ç›¸åŒï¼Œä½†æ˜¯è¿”å›å€¼å¹¶éå­—ç¬¦ä¸², è€Œæ˜¯ä¸€ä¸ªå¯¹è±¡

<details>
<summary>Example</summary>

```python
from string.templatelib import Interpolation, Template


def html(template: Template) -> str:
    parts = []
    for part in template:
        if isinstance(part, Interpolation):
            if isinstance(part.value, dict):
                value = " ".join([f'{k}="{v}"' for k, v in part.value.items()])
                parts.append(value)
        else:
            if part == ">":
                parts.append(" />")
            else:
                parts.append(part)
    return "".join(parts)


attributes = {"src": "limburger.jpg", "alt": "lovely cheese"}
template = t"<img {attributes}>"

assert html(template) == '<img src="limburger.jpg" alt="lovely cheese" />', html(
    template
)
```

</details>

### PEP 768: Safe external debugger interface

æ”¯æŒé€šè¿‡ `sys.remote_exec` åœ¨å·²è¿è¡Œçš„ Python è¿›ç¨‹ä¸­æ‰§è¡Œä»£ç 

<details>
<summary>Example</summary>

```python
import sys
from tempfile import NamedTemporaryFile

with NamedTemporaryFile(mode='w', suffix='.py', delete=False) as f:
    script_path = f.name
    f.write(f'import my_debugger; my_debugger.connect({os.getpid()})')

# Execute in process with PID 1234
print('Behold! An offering:')
sys.remote_exec(1234, script_path)
```

</details>

### Asyncio introspection capabilities

é€šè¿‡å‘½ä»¤è¡Œæ¥å£æŸ¥çœ‹æŒ‡å®šè¿›ç¨‹çš„å¼‚æ­¥ä»»åŠ¡åˆ—è¡¨å’Œè°ƒç”¨æ ˆä¿¡æ¯

- `python -m asyncio ps PID`
- `python -m asyncio pstree PID`

<details>
<summary>Example</summary>

```python
import asyncio

async def play_track(track):
    await asyncio.sleep(5)
    print(f'ğŸµ Finished: {track}')

async def play_album(name, tracks):
    async with asyncio.TaskGroup() as tg:
        for track in tracks:
            tg.create_task(play_track(track), name=track)

async def main():
    async with asyncio.TaskGroup() as tg:
        tg.create_task(
          play_album('Sundowning', ['TNDNBTG', 'Levitate']),
          name='Sundowning')
        tg.create_task(
          play_album('TMBTE', ['DYWTYLM', 'Aqua Regia']),
          name='TMBTE')

if __name__ == '__main__':
    asyncio.run(main())
```

</details>

### PEP 765: Control flow in finally blocks

åœ¨`finally`ä»£ç å—ä¸­ä½¿ç”¨`return`ã€`break`ã€`continue` ä¼šå‘å‡º `SyntaxWarning`è­¦å‘Š

<details>
<summary>Example</summary>

```python
def process_file(path):
    f = open(path, "w")
    try:
        # æŸäº›æ“ä½œå¯èƒ½æŠ›å‡ºå¼‚å¸¸
        return "done"
    finally:
        print("closing file...")
        return "cleanup done"
        # SyntaxWarning: 'return' in a 'finally' block

```

</details>

## Nice

1. æ–°å¢`annotationlib`åº“è·å–æ³¨è§£ä¿¡æ¯

### PEP 784: Zstandard support in the standard library

å†…ç½®çš„ zstd å‹ç¼©ç®—æ³•å®ç°

<details>
<summary>Example</summary>

```python
from compression import zstd
import math

data = str(math.pi).encode() * 20
compressed = zstd.compress(data)
ratio = len(compressed) / len(data)
print(f"Achieved compression ratio of {ratio}")
```

</details>

## Trivial

### PEP 758: Allow except and except* expressions without brackets

å…è®¸åœ¨æ•è·å¤šä¸ªå¼‚å¸¸ä¸”æœªä½¿ç”¨`as`å­å¥æ—¶çœç•¥æ‹¬å·

<details>
<summary>Example</summary>

```python
try:
    connect_to_server()
except TimeoutError, ConnectionRefusedError:
    print('The network has ceased to be!')
```

</details>

### Incremental garbage collection

1. æœªä¸»åŠ¨è°ƒç”¨ gc.collect çš„æƒ…å†µä¸‹ï¼Œåƒåœ¾å›æ”¶çš„è§¦å‘é¢‘ç‡é™ä½
2. `gc.collect(1)` è§¦å‘å¢é‡å¼å›æ”¶
3. `yong` å’Œ `old`

## æ€»ç»“
